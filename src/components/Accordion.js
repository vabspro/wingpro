import React, { useEffect, useState, useRef } from "react"
import gsap from "gsap"
import { useInView } from "react-intersection-observer"
import { motion, useAnimation } from "framer-motion"

function Accordion() {
  const container = useRef(null)
  const { ref, inView } = useInView({ threshold: 0.5 })
  const animation = useAnimation()
  const [activeItem, setActiveItem] = useState(0)
  const [animatedOnce, setAnimatedOnce] = useState(false)

  const handleClickEvent = ({ event, index }) => {
    const currentActiveElement = container.current.querySelector(
      ".accordion__item.active"
    )
    const nextActiveElement = event.target.parentElement

    if (!nextActiveElement.classList.contains("active")) {
      const timeline = gsap.timeline()
      timeline
        .to(currentActiveElement.querySelector(".accordion__item--body"), {
          ease: "Power3.easeInOut",
          duration: 0.4,
          height: 0,
          opacity: 0,
          y: -10,
        })
        .to(nextActiveElement.querySelector(".accordion__item--body"), {
          ease: "Power3.easeInOut",
          duration: 0.4,
          y: 0,
          opacity: 1,
          height: nextActiveElement.querySelector(".accordion__item--body")
            .scrollHeight,
        })
    }
    setActiveItem(index)
  }

  useEffect(() => {
    gsap.to(
      container.current.querySelector(
        ".accordion__item.active .accordion__item--body"
      ),
      {
        height: container.current.querySelector(
          ".accordion__item.active .accordion__item--body"
        ).scrollHeight,
        ease: "Power3.easeInOut",
        duration: 0.4,
      }
    )
  }, [])

  useEffect(() => {
    if (inView && !animatedOnce) {
      setAnimatedOnce(true)
      animation.start("visible")
    }
  }, [animation, inView])

  const variants = {
    visible: {
      opacity: 1,
      transition: {
        staggerChildren: 0.2,
      },
    },
    hidden: {
      opacity: 1,
    },
  }

  const item = {
    visible: {
      y: 0,
      opacity: 1,
      transition: {
        type: "spring",
        duration: 1,
        bounce: 0,
      },
    },
    hidden: {
      y: 40,
      opacity: 0,
      transition: {
        type: "spring",
        duration: 1,
        bounce: 0,
      },
    },
  }

  return (
    <div className="accordion" ref={container}>
      <motion.div
        className="accordion__container"
        ref={ref}
        initial="hidden"
        animate={animation}
        variants={variants}
      >
        <motion.div
          variants={item}
          className={
            activeItem === 0 ? "accordion__item active" : "accordion__item"
          }
        >
          <div
            className="accordion__item--header"
            onClick={event => handleClickEvent({ event, index: 0 })}
          >
            <div>
              <svg viewBox="0 0 42 42" className="icon">
                <path d="m.28646 14.144.73982-1.0282s4.7158-3.68866 6.73383-4.7331c1.65223-.85513 3.54779-1.48958 5.37429-1.53348s3.8377.68782 5.5847 1.27009c1.6995.56639 3.3685 1.28427 4.8971 2.22329 1.5307.9403 3.0055 2.1367 4.2871 3.4186 1.2816 1.282 2.4796 2.7045 3.4026 4.273.925 1.5719 1.5425 3.4004 2.1474 5.1582.6049 1.7579 1.474 3.6296 1.4819 5.3891.0079 1.7594-.608 3.5852-1.4343 5.1674-1.0486 2.0079-3.8801 5.5958-4.8573 6.8799-.2626.3451-.7778.713-1.0061.8247-.1175.0575-.2946-.0427-.3637-.155-.3614-.5864-1.0699-2.3238-1.8042-3.3638-.8128-1.1513-1.9648-2.4411-3.0731-3.5443-1.1524-1.1471-2.4835-2.3219-3.8413-3.3386-1.4252-1.0672-3.3964-1.7526-4.7098-3.0642-1.3134-1.3117-2.0877-3.3666-3.1705-4.8056-1.01635-1.3506-2.18349-2.6805-3.32653-3.8283-1.09887-1.1035-2.39974-2.2395-3.53147-3.0583-1.01308-.733-2.67049-1.4962-3.258894-1.8547-.114422-.0698-.271546-.2967-.271546-.2967z" />
              </svg>
              <strong>Wing</strong>
            </div>
            {activeItem === 0 && (
              <svg viewBox="0 0 42 41">
                <path d="m35.0631 14.4211-1.8263 1.8263 2.9611 2.9611h-36.05581v2.5829h36.05581l-2.9611 2.9612 1.8263 1.8263 6.079-6.0789z" />
              </svg>
            )}
          </div>
          <div className="accordion__item--body">
            <p>
              Mit steigendem Fertigkeitslevel und dem Start in die Gleitfahrt
              wird die passende Wahl des Foils immer wichtiger. Die
              verschiedenen Mastlängen, als auch Größen des Flügels machen einen
              erheblichen Unterschied. So bieten wir diverse Mastlängen von 60
              bis 110cm und Winggrößen von 600cm2 – 1200cm2. Der optimalen
              Zusammenstellung des Setups steht so also nichts im Wege.
            </p>
          </div>
        </motion.div>
        <motion.div
          variants={item}
          className={
            activeItem === 1 ? "accordion__item active" : "accordion__item"
          }
        >
          <div
            className="accordion__item--header"
            onClick={event => handleClickEvent({ event, index: 1 })}
          >
            <div>
              <svg viewBox="0 0 37 40" className="icon">
                <path d="m20.6101.0469148c-.0849.0232245-.2057.0981002-.267.1657302-.2059.226114-.3211.277393-1.0262.456872-.0854.021739-.2887.061127-.4459.086581-.157.025454-.3653.067073-.4565.091412-.1572.041804-.1678.054996-.1678.21014 0 .19118.021.22964.1784.32718.1555.09624.7646.19732 2.2764.37735.3567.04255.6531.08361.6623.09179.0093.00799.0316.17836.0489.37363.0245.2761.053.37847.1232.44387.0908.08435.0912.11036.0765 4.80301-.0081 2.59522-.0178 8.20252-.0213 12.46212l-.0063 7.7439-.1295-.0042c-.0723-.0024-.1578.0202-.1933.0513-.0615.0535-.1401.0406-.8281-.1346-.0871-.0221-.2867-.0683-.4481-.1036-.1583-.0346-.4331-.0967-.6029-.1359-.17-.0393-.3935-.0897-.4905-.1105-.0972-.0208-.3101-.07-.4673-.1081-.1598-.0389-.518-.1214-.8026-.1849-.2845-.0634-.5831-.1327-.6689-.155-.0844-.0219-.3079-.0732-.4905-.1124-.6072-.1306-.9123-.1997-1.0702-.2422-.086-.0233-.3079-.0751-.4905-.1147-.1824-.0396-.4043-.0893-.4905-.1103-.086-.021-.3079-.0708-.4905-.1104-.1824-.0396-.4043-.0896-.4903-.1106-.0857-.0208-.2995-.072-.4693-.1124-.1698-.0405-.3935-.0936-.4905-.1168-.0978-.0232-.5011-.1135-.8919-.1996-.3907-.086-.794-.1754-.8918-.1975-.097-.0219-.3101-.0704-.4671-.1061-.1596-.0364-.43324-.0971-.61161-.136-.27182-.0589-.35152-.0988-.50536-.2526-.12318-.1232-.21088-.1751-.26959-.1593-.04682.0127-.08658.0154-.08602.0063.0013-.0232.78889-.6278 1.36208-1.0458.2506-.1826.5704-.4312.7051-.5479.6276-.5446 1.0566-1.6549.9314-2.4109-.0914-.5511-.3497-.7235-1.0717-.7151-.4777.0055-.5293.0442-.82623.6174-.36527.7051-.47136.8606-.84073 1.2316-.38292.3848-.68986.5814-1.8195 1.165-.30582.1579-.76678.4219-1.02355.586-.52469.3353-.48418.3284-1.37173.2302-.67518-.0749-.79521-.0502-.8541.1761-.04385.1689.01542.5648.11259.7517.04403.0849.05314.1423.02397.1529-.02583.0093-.21887.1358-.43105.2824-.21237.1466-.40634.2522-.43328.2356-.02842-.0172-.03586-.0083-.01746.0214.05536.0903-1.06759.748-1.56013.9136l-.327.1098-.437553-.1295c-.241907-.0718-.496076-.1496-.568908-.1745-.144363-.0494-.180036-.0364-.146221.0535.020809.0552.426402.2731.846862.4547.395.1705.47173.2008.72627.2861.62632.2096.90873.2528 1.64764.2528.66682 0 .73984-.0083 1.11701-.1287.46895-.1496.85355-.3474 1.82173-.9368l.70491-.4292.53937.1297c.58005.1395 1.51182.3584 2.12773.4998.46706.1074.79836.186 1.31636.3131.2209.054.479.1139.5776.1339.0989.0201.3079.0682.4694.1083.1612.04.3797.0901.4905.1124.1107.0225.3184.0716.4671.1106.1486.0388.3175.0804.3801.0934.0621.0129.312.0708.5583.1295.2464.0586.5866.1375.7603.1764.4899.1094.6326.1423 1.1337.2618.6202.1478 1.2079.2861 1.5629.3673.4586.1051.8541.1984 1.0234.2417.0862.0219.3781.0925.6456.1564.7347.1752 1.3664.3335 1.5202.3809.0766.0236.1639.042.1998.042.0349 0 .1096.0489.1655.1083.057.0604.1657.1214.2464.1381.0789.0161.225.055.3227.0856.2202.069.3779.1121 1.1594.3161.3439.0899.6738.1793.7346.1991.1215.0396.4671.1232.5903.1429.0769.0121.0804.0078-.7657.9082-.5063.5386-.9726 1.0616-1.8065 2.0257-.4151.4799-.8834 1.0096-1.0438 1.1806-.7447.7941-2.7208 2.7282-3.2637 3.1944-.6668.5724-.785.7075-1.0029 1.1458-.2742.552-.3848 1.0085-.2876 1.1891.0301.0563.1375.1371.2395.1804.1018.0434.2246.0956.2738.1168.0496.0212.2421.0541.4333.074.5741.0594 1.0956-.047 2.6075-.5333.3651-.1176 1.0798-.2506 1.3292-.2476.0882.0011.4925-.0338.9555-.0825 1.342-.1412 3.076-.5253 4.2594-.9429.2473-.0874.654-.231.9132-.3226.6928-.2447 1.6859-.7012 2.4417-1.1226.8706-.4851 1.6608-.9588 2.0172-1.2097.4959-.3485.3738-.2593 1.5077-1.1006.5011-.3718.9307-.6609.9576-.6446.0255.0157.0357.0095.0212-.0126-.0151-.0234.1254-.1611.3121-.3062.4036-.313.973-.8047 1.2911-1.1146.3908-.3807.6672-1.0339.8422-1.9893.0682-.3725.0725-.5013.03-.9174-.0978-.9597-.5974-2.1402-1.2477-2.9471-.6945-.8621-1.0298-1.1171-1.8157-1.3796-.6823-.228-1.2317-.3365-1.9877-.3929l-.3779-.0283-.6901.652c-.3779.3571-.8782.7978-1.1062.9747-.2294.1778-.5001.3879-.6031.4678-.3697.2874-.7517.5451-1.3334.9002-.3228.1971-.6663.4104-.7581.4708l-.1678.1104.0212-.8579c.0117-.4717.0324-1.4906.0457-2.2635.0292-1.6902.0584-3.2169.0888-4.6587.0125-.5878.0324-1.6032.0439-2.2529.0117-.6498.0321-1.7051.0453-2.342.0426-2.0428.0652-3.178.0911-4.5483.0137-.7346.0336-1.72919.0442-2.20613.0104-.47731.0325-1.6521.0488-2.60764.0164-.95537.0335-1.87004.0381-2.02983.0047-.15978.0125-.497.0171-.74745.0082-.44592.011-.45651.1124-.45651.0978 0 .1061-.02136.1346-.34409.0457-.518.0464-.52246.0927-.552.0256-.01635.1869-.05425.3567-.08417.4927-.08639.9061-.21719 1.2699-.4015.3736-.18914.4303-.25677.4717-.56333.0242-.17837.0132-.23708-.062-.33332-.0806-.103119-.1421-.122814-.5286-.167776-.241-.028055-1.6393-.191928-3.113-.364904-4.0344-.4732222-4.1737-.48845749-4.4123-.48418418-.1232.00222955-.2952.02322448-.3801.04644898z" />
              </svg>

              <strong>Foil</strong>
            </div>

            {activeItem === 1 && (
              <svg viewBox="0 0 42 41">
                <path d="m35.0631 14.4211-1.8263 1.8263 2.9611 2.9611h-36.05581v2.5829h36.05581l-2.9611 2.9612 1.8263 1.8263 6.079-6.0789z" />
              </svg>
            )}
          </div>
          <div className="accordion__item--body">
            <p>
              Mit steigendem Fertigkeitslevel und dem Start in die Gleitfahrt
              wird die passende Wahl des Foils immer wichtiger. Die
              verschiedenen Mastlängen, als auch Größen des Flügels machen einen
              erheblichen Unterschied. So bieten wir diverse Mastlängen von 60
              bis 110cm und Winggrößen von 600cm2 – 1200cm2. Der optimalen
              Zusammenstellung des Setups steht so also nichts im Wege.
            </p>
          </div>
        </motion.div>
        <motion.div
          variants={item}
          className={
            activeItem === 2 ? "accordion__item active" : "accordion__item"
          }
        >
          <div
            className="accordion__item--header"
            onClick={event => handleClickEvent({ event, index: 2 })}
          >
            <div>
              <svg className="icon" viewBox="0 0 34 30"></svg>
              <strong>Board</strong>
            </div>
            {activeItem === 2 && (
              <svg viewBox="0 0 42 41">
                <path d="m35.0631 14.4211-1.8263 1.8263 2.9611 2.9611h-36.05581v2.5829h36.05581l-2.9611 2.9612 1.8263 1.8263 6.079-6.0789z" />
              </svg>
            )}
          </div>
          <div className="accordion__item--body">
            <p>
              Mit steigendem Fertigkeitslevel und dem Start in die Gleitfahrt
              wird die passende Wahl des Foils immer wichtiger. Die
              verschiedenen Mastlängen, als auch Größen des Flügels machen einen
              erheblichen Unterschied. So bieten wir diverse Mastlängen von 60
              bis 110cm und Winggrößen von 600cm2 – 1200cm2. Der optimalen
              Zusammenstellung des Setups steht so also nichts im Wege.
            </p>
          </div>
        </motion.div>
        <motion.div
          variants={item}
          className={
            activeItem === 3 ? "accordion__item active" : "accordion__item"
          }
        >
          <div
            className="accordion__item--header"
            onClick={event => handleClickEvent({ event, index: 3 })}
          >
            <div>
              <svg viewBox="0 0 34 30" className="icon">
                <path d="m4.30707 21.1985v-8.6867c0-.5142.13738-.891.11905-.8408-.08304.0067-.16544.0158-.24721.0274v-6.42556c0-.54516-.43033-.98713-.96114-.98713-.53082 0-.96115.44197-.96115.98713v7.21566c-1.271026.9268-2.11453 2.5373-2.11453 4.3667 0 2.7417 1.89346 4.9929 4.28403 5.1841.01032.0282-.11905-.3459-.11905-.8408z" />
                <path d="m18.5333 24.1029h-4.1361c-1.3359 0-2.4723.8419-2.8779 2.0075h-.2242c-1.40805 0-2.60352-.897-3.01396-2.133-1.34896 0-1.54064.0263-2.01649-.0998.4129 2.3333 2.51069 4.1149 5.03045 4.1149h.2242c.4056 1.1656 1.542 2.0075 2.8779 2.0075h4.1361c1.6749 0 3.0375-1.3227 3.0375-2.9485 0-1.6259-1.3626-2.9486-3.0375-2.9486z" />
                <path d="m8.8312 9.69153c.66066-4.37895 4.0717-7.67246 8.1476-7.67246 4.0758 0 7.4868 3.29351 8.1475 7.67246 1.3031 0 1.4903-.02705 1.9545.10439-.6435-5.55803-4.9394-9.79592-10.102-9.79592-5.1627 0-9.4586 4.23789-10.10209 9.79592.46284-.13104.65162-.10439 1.95449-.10439z" />
                <path d="m26.076 11.6327h-2.276c-.5541 0-1.0048.4323-1.0048.9637v8.4807c0 .5314.4507.9637 1.0048.9637h2.276c.5541 0 1.0049-.4323 1.0049-.9637v-8.4807c0-.5314-.4508-.9637-1.0049-.9637z" />
                <path d="m7.26911 22.0408h2.27679c.5539 0 1.0045-.4323 1.0045-.9637v-8.4807c0-.5314-.4506-.9637-1.0045-.9637h-2.27679c-.55386 0-1.00446.4323-1.00446.9637v8.4807c0 .5314.4506.9637 1.00446.9637z" />
                <path d="m28.9188 11.6328c-.0016-.0069.1191.3638.1191.8438v8.7186c0 .5171-.1336.8737-.1191.8439 2.3909-.1919 4.2846-2.4514 4.2846-5.2032s-1.8937-5.0113-4.2846-5.2031z" />
              </svg>
              <strong>Headset</strong>
            </div>

            {activeItem === 3 && (
              <svg viewBox="0 0 42 41">
                <path d="m35.0631 14.4211-1.8263 1.8263 2.9611 2.9611h-36.05581v2.5829h36.05581l-2.9611 2.9612 1.8263 1.8263 6.079-6.0789z" />
              </svg>
            )}
          </div>
          <div className="accordion__item--body">
            <p>
              Mit steigendem Fertigkeitslevel und dem Start in die Gleitfahrt
              wird die passende Wahl des Foils immer wichtiger. Die
              verschiedenen Mastlängen, als auch Größen des Flügels machen einen
              erheblichen Unterschied. So bieten wir diverse Mastlängen von 60
              bis 110cm und Winggrößen von 600cm2 – 1200cm2. Der optimalen
              Zusammenstellung des Setups steht so also nichts im Wege.
            </p>
          </div>
        </motion.div>
        <motion.div
          variants={item}
          className={
            activeItem === 4 ? "accordion__item active" : "accordion__item"
          }
        >
          <div
            className="accordion__item--header"
            onClick={event => handleClickEvent({ event, index: 4 })}
          >
            <div>
              <svg viewBox="0 0 16 40" className="icon">
                <path d="M15.4626 15.9508C15.4075 17.1508 15.2831 18.2828 15.2085 19.0231H13.4773C13.4551 18.5428 13.367 17.9515 13.2657 17.4932C13.2137 17.264 13.1581 17.0675 13.1052 16.9333C12.9062 16.4257 12.6788 13.0485 12.7936 12.5432L12.7972 12.515C12.8813 11.9966 12.3917 10.1373 12.294 9.22285V9.21882C12.2868 9.16019 12.2809 9.10334 12.2786 9.05276C11.9404 9.6145 11.5692 12.8234 11.5692 13.2737C11.5692 13.5252 11.8215 15.1115 12.0571 16.6244V16.628C12.1584 17.2775 12.2556 17.9135 12.3302 18.4229C12.3917 18.8562 12.4355 19.1972 12.4509 19.383C12.5142 20.1645 12.223 25.1432 11.9594 27.1977C11.9138 27.5567 11.8676 27.8257 11.8251 27.9676C11.5425 28.9232 11.8423 31.5779 11.883 32.0488C11.9463 32.7797 11.9061 34.5934 11.7415 35.8198C11.7243 35.9528 11.6958 36.2173 11.6651 36.562C11.5792 37.5198 11.4743 39.0721 11.51 40H9.49252C9.47533 39.8187 9.44821 39.6665 9.40977 39.5645C9.35461 39.415 9.26464 38.9678 9.162 38.3909C8.89614 36.8914 8.54979 34.5137 8.52854 34.1883C8.50051 33.738 8.63027 31.3559 8.73924 30.5005C8.87715 29.437 8.24369 28.3046 8.21566 26.4757C8.20345 25.7721 8.24369 24.3084 8.21566 23.9145L8.2134 23.8957C8.17542 23.4338 7.81732 20.5848 7.81732 20.0848C7.81732 20.1323 7.81325 20.2025 7.80782 20.2876L7.80647 20.3086C7.74678 21.1564 7.44475 23.5587 7.41988 23.9145C7.39094 24.3084 7.42892 25.7721 7.41988 26.4757C7.39094 28.3046 6.75794 29.437 6.89404 30.5005C7.00481 31.3559 7.13503 33.738 7.10609 34.1883C7.08529 34.5137 6.7385 36.8914 6.47309 38.3909C6.37 38.9678 6.28002 39.415 6.22441 39.5645C6.18643 39.6665 6.1593 39.8187 6.14212 40H4.12329C4.15856 39.0721 4.05592 37.5198 3.97001 36.5642C3.93926 36.2191 3.91033 35.9528 3.8936 35.8198C3.72902 34.5934 3.68878 32.7797 3.75208 32.0488C3.79187 31.5779 4.09254 28.9232 3.80769 27.9676C3.76564 27.8257 3.72088 27.5567 3.67521 27.1986C3.41161 25.1472 3.11862 20.1645 3.18237 19.383C3.19729 19.1972 3.2416 18.8562 3.30264 18.4251C3.37499 17.9135 3.47491 17.2792 3.57393 16.6302C3.81131 15.1155 4.0636 13.5252 4.0636 13.2737L4.0618 13.2378C4.04823 12.7021 3.71364 9.85442 3.39669 9.13378L3.35419 9.05276C3.35193 9.10916 3.34605 9.17361 3.33927 9.2412C3.23527 10.1807 2.73475 12.0701 2.84191 12.5432C2.95404 13.0485 2.72661 16.4257 2.52812 16.9333C2.47612 17.0675 2.42096 17.264 2.36942 17.4954C2.26813 17.9533 2.18042 18.5428 2.15691 19.0231H0.426546C0.351942 18.2828 0.225793 17.1486 0.170632 15.9508C0.0996447 14.4213 0.139886 12.7835 0.537322 11.7254C0.700094 11.2975 0.597005 7.94136 0.62549 7.65893C0.56852 7.37694 0.510645 4.85738 1.30597 4.0414C1.77304 3.56426 2.28893 3.23124 2.76097 2.99043C3.39443 2.66726 3.94831 2.51553 4.19382 2.41884C4.26436 2.39065 4.35614 2.34544 4.46149 2.28859C4.99683 1.99675 5.88756 1.40413 6.0544 1.31103C6.11137 1.27925 6.13081 1.09618 6.13081 0.876406C6.13081 0.493706 6.0752 0.00179041 6.0752 0.00179041H7.64957L7.98325 0H9.58023L9.55943 0.00179041C9.55943 0.00179041 9.50382 0.491915 9.50382 0.874168C9.50382 1.09618 9.52326 1.27925 9.58023 1.31103C9.74707 1.40413 10.6364 1.99496 11.1718 2.28635C11.2785 2.34544 11.3698 2.39065 11.4413 2.41884C11.6859 2.51553 12.2384 2.66726 12.8719 2.98909C13.3443 3.229 13.8621 3.56426 14.3282 4.0414C15.124 4.85738 15.0666 7.37694 15.0091 7.65893C15.0381 7.94136 14.935 11.2975 15.0955 11.7254C15.4929 12.7853 15.5332 14.4213 15.4626 15.9508Z" />
              </svg>

              <strong>Neoprenanzug</strong>
            </div>

            {activeItem === 4 && (
              <svg viewBox="0 0 42 41">
                <path d="m35.0631 14.4211-1.8263 1.8263 2.9611 2.9611h-36.05581v2.5829h36.05581l-2.9611 2.9612 1.8263 1.8263 6.079-6.0789z" />
              </svg>
            )}
          </div>
          <div className="accordion__item--body">
            <p>
              Mit steigendem Fertigkeitslevel und dem Start in die Gleitfahrt
              wird die passende Wahl des Foils immer wichtiger. Die
              verschiedenen Mastlängen, als auch Größen des Flügels machen einen
              erheblichen Unterschied. So bieten wir diverse Mastlängen von 60
              bis 110cm und Winggrößen von 600cm2 – 1200cm2. Der optimalen
              Zusammenstellung des Setups steht so also nichts im Wege.
            </p>
          </div>
        </motion.div>
      </motion.div>
    </div>
  )
}

export default Accordion
